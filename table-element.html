<link rel="import" href="components/polymer/polymer.html">

<dom-module id="table-element">
        <template>
            <style>
            paper-card {
                width: 100%;
                margin:10px;
            }
            paper-input iron-icon {
                color: var(--paper-grey-600);
            }
            .margin-10{
                margin:10px;
            }
            .margin-3{
                margin:3px;
            }
            .is-failed-class{
                color:#ffffff;
                background-color:var(--paper-red-600);
            }
            .is-running-class{
                color:#ffffff;
                background-color:var(--paper-green-600);
            }
            .is-success-class{
                color:#ffffff;
                background-color:var(--paper-blue-600);
                
            }
            .is-on-hold-class{
                color:#ffffff;
                background-color:var(--paper-yellow-600);
            }
            </style>
            <paper-dialog id="warningMessageDialog">
                <h2>{{warningTitle}}</h2>
                <div>{{warningMessage}}</div>
                <div class="buttons">
                    <paper-button dialog-dismiss>Cancel</paper-button>
                    <paper-button dialog-confirm autofocus on-tap="_tapConfirmRequest">Accept</paper-button>
                </div>
            </paper-dialog>
            <div class="layout horizontal center">
                <div>
                    <!-- filtering section -->
                    <paper-card class="filter-container">
                        <div class="card-content">
                            <h4>Job Filtering</h4>
                            <div class="horizontal layout wrap">
                                <div class="margin-3 horizontal layout center">
                                    <div>Last Run Timestamp:</div>
                                    <div class="margin-3"></div>
                                    <paper-input no-label-float type="date"></paper-input>
                                </div>
                                <div class="margin-3 horizontal layout center">
                                    <div>Owner:</div>
                                    <div class="margin-3"></div>
                                    <paper-input no-label-float value="{{selectedOwner}}"></paper-input>
                                </div>
                                <div class="margin-3 horizontal layout center">
                                    <div>Job Type:</div>
                                    <div class="margin-3"></div>
                                    <paper-input no-label-float value="{{selectedJobType}}"></paper-input>
                                </div>
                            </div>
                            <div class="margin-3 horizontal layout center">
                                <div>Status:</div>
                                <div class="margin-3"></div>
                                <paper-checkbox checked="{{isFailedTask}}">Failed</paper-checkbox>
                                <div class="margin-3"></div>
                                <paper-checkbox checked="{{isRunningTask}}">Running</paper-checkbox>
                                <div class="margin-3"></div>
                                <paper-checkbox checked="{{isSucessfulTask}}">Success</paper-checkbox>
                                <div class="margin-3"></div>
                                <paper-checkbox checked="{{isOnHoldTask}}">On-Hold</paper-checkbox>
                                <div class="margin-3"></div>
                                <paper-checkbox checked="{{isDisabledTask}}">Disabled</paper-checkbox>
                                <div class="margin-3"></div>
                            </div>
                            <div class="horizontal layout flex">
                                <div class="flex"></div>
                                <paper-button on-tap="_tapFilterResult">Filter</paper-button>
                            </div>
                        </div>
                    </paper-card>
        
                    <!-- table section -->
                    <paper-card class="flex">
                        <div class="horizontal center layout margin-10">
                            <paper-input class="flex" no-label-float label="Search">
                                <iron-icon icon="search" prefix></iron-icon>
                            </paper-input>
                            <div class="margin-10"></div>
                            <paper-menu-button ignore-select horizontal-align="right">
                                <paper-icon-button icon="menu" class="dropdown-trigger"></paper-icon-button>
                                <paper-menu class="dropdown-content">
                                    <template is="dom-repeat" items="[[toggleColumns]]" as="column" index-as="index">
                                        <paper-icon-item column-property="[[column.property]]" on-tap="_hideColumn">
                                            <template is="dom-if" if="[[column.hidden]]">
                                                <iron-icon icon="visibility-off" item-icon></iron-icon>
                                            </template>
                                            <template is="dom-if" if="[[!column.hidden]]">
                                                <iron-icon disabled icon="visibility" item-icon></iron-icon>
                                            </template>
                                            [[column.header]]
                                        </paper-icon-item>
                                    </template>
                                </paper-menu>
                            </paper-menu-button>
                        </div>
                        
                        <div class="card-content">
                           <!-- <paper-datatable-api paginate
                                data="[[data]]" page="{{page}}" size="{{size}}"
                                available-size="[4]" toggle-columns="{{toggleColumns}}"
                                on-sort="_handleSort" selected-rows="{{selectedRows}}"
                                on-selection-changed="_handleSelectionChanged" total-elements="[[totalElements]]"
                                total-pages="[[totalPages]]" selectable-data-key="fruit">-->
                           <paper-datatable-api paginate filters
                               data="[[data]]" page="{{page}}" size="{{size}}"
                               available-size="[4]" toggle-columns="{{toggleColumns}}"
                               on-sort="_handleSort" on-filter="_handleFilter"
                               total-elements="[[totalElements]]"
                               total-pages="[[totalPages]]" selectable-data-key="fruit">
                               
                                <paper-datatable-api-column header="Job Title" property="name" sortable  hideable>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Job Type" property="type" sortable hideable>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Owner" property="owner" sortable hideable>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Last Run" property="lastrun" sortable hideable>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Status" property="status" sortable hideable>
                                    <template>
                                        <template is="dom-if" if="{{_isFailed(value)}}">
                                            <paper-item class="is-failed-class">[[value]]</paper-item>
                                        </template>
                                        <template is="dom-if" if="{{_isRunning(value)}}">
                                            <paper-item class="is-running-class">[[value]]</paper-item>
                                        </template>
                                        <template is="dom-if" if="{{_isSuccess(value)}}">
                                            <paper-item class="is-success-class">[[value]]</paper-item>
                                        </template>
                                        <template is="dom-if" if="{{_isDisabled(value)}}">
                                            <paper-item>[[value]]</paper-item>
                                        </template>
                                        <template is="dom-if" if="{{_isOnHold(value)}}">
                                            <paper-item class="is-on-hold-class">[[value]]</paper-item>
                                        </template>
                                        <template is="dom-if" if="{{_isEnabled(value)}}">
                                            <paper-item>[[value]]</paper-item>
                                        </template>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Progress" property="progress" sortable hideable>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Details" property="details" sortable hideable>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Actions" property="actions">
                                    <template>
                                       <div class="horizontal layout center">
                                        <iron-icon icon="av:play" on-tap="_tapPlay"></iron-icon>
                                        <iron-icon icon="av:stop" on-tap="_tapStop" ></iron-icon>
                                        <iron-icon icon="av:fast-forward" on-tap="_tapForceStart"></iron-icon>
                                        <iron-icon icon="av:not-interested" on-tap="_tapDisabled"></iron-icon>
                                        <iron-icon icon="done" on-tap="_tapEnabled"></iron-icon>
                                        </div>
                                    </template>
                                </paper-datatable-api-column>
                            </paper-datatable-api>
                        </div>
                    </paper-card>
               </div>
            </div>
        </template>
        
        <script>
            Polymer({
                    is: 'table-element',
                    properties: {
                        sortProperty: {
                            type: String,
                        },
                        selectedRows: {
                            type: Array,
                            value: [],
                        },
                        isFailed:{type:String, value:"FAILED"},
                        isEnabled:{type:String, value:"READY"},
                        isDisabled:{type:String, value:"DISABLED"},
                        isSuccess:{type:String, value:"SUCCESS"},
                        isRunning:{type:String, value:"RUNNING"},
                        isOnHold:{type:String, value:"ON-HOLD"},
                    },
                    ready:function(){
                        this.data=[{
                                   "id": "1",
                                   "name": "Job 1",
                                   "type":"Security",
                                   "owner": "John",
                                   "lastrun":"Jun 25, 2017 9:15pm",
                                   "status":"FAILED",
                                   "progress":20,
                                   "details":"Please Wait",
                                   "action":"start",
                                   "hiddenColumn": 1
                                   },{
                                   "id": "2",
                                   "name": "Job 2",
                                   "type":"Security",
                                   "owner": "John",
                                   "lastrun":"Jun 25, 2017 9:15pm",
                                   "status":"RUNNING",
                                   "progress":1,
                                   "details":"Please Wait",
                                   "action":"start",
                                   "hiddenColumn": 1
                                   },{
                                   "id": "3",
                                   "name": "Job 3",
                                   "type":"Security",
                                   "owner": "John",
                                   "lastrun":"Jun 25, 2017 9:15pm",
                                   "status":"SUCCESS",
                                   "progress":100,
                                   "details":"Please Wait",
                                   "action":"start",
                                   "hiddenColumn": 1
                                   },{
                                   "id": "4",
                                   "name": "Job 4",
                                   "type":"Security",
                                   "owner": "John",
                                   "lastrun":"Jun 25, 2017 9:15pm",
                                   "status":"ON-HOLD",
                                   "progress":20,
                                   "details":"Please Wait",
                                   "action":"start",
                                   "hiddenColumn": 1
                                   }];
                    },
                    
                    _isFailed:function(status){
                        if(status==this.isFailed){
                            return true;
                        }
                        return false;
                    },
                    _isRunning:function(status){
                        if(status==this.isRunning){
                            return true;
                        }
                        return false;
                    },
                    _isOnHold:function(status){
                        if(status==this.isOnHold){
                            return true;
                        }
                        return false;
                    },
                    _isEnabled:function(status){
                        if(status==this.isEnabled){
                            return true;
                        }
                        return false;
                    },
                    _isSuccess:function(status){
                        if(status==this.isSuccess){
                            return true;
                        }
                            return false;
                    },
                    _isDisabled:function(status){
                        if(status==this.isDisabled){
                            return true;
                        }
                        return false;
                    },
                    
                    _tapConfirmRequest:function(){
                    
                    },
                    
                    _tapFilterResult:function(){
                    
                    },
                    
                    _tapPlay:function(e){
                       console.log("play");
                        console.log(e.detail.data.status);
                       this.warningTitle="Start Job";
                       this.warningMessage="You are about to START Job, Are you sure?";
                       this.$.warningMessageDialog.open();
                    },
                    
                    _tapStop:function(e){
                        console.log("stop");
                         console.log(e.detail.data.status);
                        this.warningTitle="Stop Job";
                        this.warningMessage="You are about to STOP Job, Are you sure?";
                        this.$.warningMessageDialog.open();
                    },
                    _tapForceStart:function(e){
                        console.log("fast forward");
                        console.log(e);
                        this.warningTitle="Force Start Job";
                        this.warningMessage="You are about to FORCE START Job, Are you sure?";
                        this.$.warningMessageDialog.open();
                    },

                    _tapDisabled:function(e){
                        console.log("disabled");
                         console.log(e.detail.data.status);
                        this.warningTitle="Disable Job";
                        this.warningMessage="You are about to DISABLE Job, Are you sure?";
                        this.$.warningMessageDialog.open();
                    },

                    _tapEnabled:function(e){
                        console.log("enabled");
                        console.log(e.detail.data.status);
                        this.warningTitle="Enable Job";
                        this.warningMessage="You are about to ENABLE Job, Are you sure?";
                        this.$.warningMessageDialog.open();
                    },

                    _hideColumn: function(event) {
                        var property = event.currentTarget.columnProperty;
                        this.$$('paper-datatable-api').toggleColumn(property);
                    },
                    _handleSort: function(event) {
                        this.sortProperty = event.detail.sort.property + ',' + event.detail.sort.direction;
                    
                    },
                    _handleFilter: function(event) {
                        var divLocal = document.createElement('div');
                        var filter = event.detail.filter.value;
                        var column = event.detail.filter.property;
                        var eventRow = document.createTextNode(filter + ' is filtered on ' + column + ' column');
                        console.log(eventRow);
                    },
                    _handleSelectionChanged: function(event) {
                        var divLocal = document.createElement('div');
                        if (event.detail.selected) {
                            var eventRow = document.createTextNode('Row ' + event.detail.selected + ' selected');
                            Polymer.dom(divLocal).appendChild(eventRow);
                            var eventData = document.createTextNode('Data : ' + JSON.stringify(event.detail.data));
                            var brLocal = document.createElement('br');
                            Polymer.dom(divLocal).appendChild(brLocal);
                            Polymer.dom(divLocal).appendChild(eventData);
                        } else {
                            var eventRow = document.createTextNode('Row ' + event.detail.deselected + ' deselected');
                            Polymer.dom(divLocal).appendChild(eventRow);
                        }
                        Polymer.dom(this.$.paperCardEvent).querySelector('.card-content').appendChild(divLocal);
                        },
                    });
            </script>
    </dom-module>
