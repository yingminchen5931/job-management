<link rel="import" href="components/polymer/polymer.html">

<dom-module id="table-element">
        <template>
            <style>
            paper-card {
                width: 100%;
                margin:10px;
            }
            paper-input iron-icon {
                color: var(--paper-grey-600);
            }
            .margin-10{
                margin:10px;
            }
            </style>
            
            <div class="layout horizontal center">
                <div>
                    <api-sample
                        data="{{dataFromApi}}"
                        page="{{page}}"
                        size="{{size}}"
                        sort-property="[[sortProperty]]"
                        total-elements="{{totalElements}}"
                        total-pages="{{totalPages}}">
                    </api-sample>
                    <paper-card heading="Job Filtering" class="filter-container">
                        <div class="card-content">
                            <div class="horizontal layout wrap">
                                <div class="margin-3 horizontal layout center">
                                    <div>Last Run Timestamp</div>
                                    <input type="date"></input>
                                </div>
                                <div class="margin-3 horizontal layout center">
                                    <div>Owner:</div>
                                    <input></input>
                                </div>
                                <div class="margin-3 horizontal layout center">
                                    <div>Job Type:</div>
                                    <input></input>
                                </div>
                                <div>Status:</div>
                                <input type="checkbox">Failed</input>
                                <input type="checkbox">Running</input>
                                <input type="checkbox">Success</input>
                                <input type="checkbox">on-hold</input>
                                <input type="checkbox">Disabled</input>
                            </div>
                            <div class="horizontal layout flex">
                                <div class="flex"></div>
                                <paper-button>Filter</paper-button>
                            </div>
                        </div>
                    </paper-card>

                    <paper-card heading="Sortable, paginable, filterable, draggable (fruit and color), with toggle column">
                        
                        <div class="horizontal center layout">
                            <paper-input class="flex" no-label-float label="Search">
                                <iron-icon icon="search" prefix></iron-icon>
                            </paper-input>
                            <div class="margin-10"></div>
                            <paper-menu-button ignore-select horizontal-align="right">
                                <paper-icon-button icon="menu" class="dropdown-trigger"></paper-icon-button>
                                <paper-menu class="dropdown-content">
                                    <template is="dom-repeat" items="[[toggleColumns]]" as="column" index-as="index">
                                        <paper-icon-item column-property="[[column.property]]" on-tap="_hideColumn">
                                            <template is="dom-if" if="[[!column.hidden]]">
                                                <iron-icon icon="visibility-off" item-icon></iron-icon>
                                            </template>
                                            <template is="dom-if" if="[[column.hidden]]">
                                                <iron-icon disabled icon="visibility" item-icon></iron-icon>
                                            </template>
                                            [[column.header]]
                                        </paper-icon-item>
                                    </template>
                                </paper-menu>
                            </paper-menu-button>
                        </div>
                        
                        <div class="card-content">
                            <paper-datatable-api paginate selectable filters
                                data="[[dataFromApi]]" page="{{page}}" size="{{size}}"
                                available-size="[2, 4]" toggle-columns="{{toggleColumns}}"
                                on-sort="_handleSort" on-filter="_handleFilter" selected-rows={{selectedRows}}
                                on-selection-changed="_handleSelectionChanged" total-elements="[[totalElements]]"
                                total-pages="[[totalPages]]" selectable-data-key="fruit">
                                
                                <paper-datatable-api-column header="Fruit" property="fruit" filter
                                    choices='[{"key": "banana","label": "banana"},{"key": "apple","label": "apple"},{"key": "orange","label": "orange"},{"key":"strawberry","label": "strawberry"}]'
                                    sortable draggable-column hideable>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Color" property="color" draggable-column filter>
                                    <template>
                                        <span>[[value]]</span>
                                    </template>
                                </paper-datatable-api-column>
                                <paper-datatable-api-column header="Weight" property="weight" hideable>
                                    <template>
                                        <span>[[value.kg]]</span>
                                    </template>
                                </paper-datatable-api-column>
                            </paper-datatable-api>
                        </div>
                    </paper-card>
               </div>
            </div>
        </template>
        
        <script>
            Polymer({
                    is: 'table-element',
                    properties: {
                    sortProperty: {
                    type: String,
                    },
                    selectedRows: {
                    type: Array,
                    value: [],
                    },
                    },
                    ready: function() {
                    // this.$$('paper-datatable-api').changeColumnOrder(['color', 'fruit', 'weight']);
                    },
                    _hideColumn: function(event) {
                    var property = event.currentTarget.columnProperty;
                    this.$$('paper-datatable-api').toggleColumn(property);
                    },
                    _handleSort: function(event) {
                    this.sortProperty = event.detail.sort.property + ',' + event.detail.sort.direction;
                    },
                    _handleFilter: function(event) {
                    var divLocal = document.createElement('div');
                    var filter = event.detail.filter.value;
                    var column = event.detail.filter.property;
                    var eventRow = document.createTextNode(filter + ' is filtered on ' + column + ' column');
                    Polymer.dom(divLocal).appendChild(eventRow);
                    Polymer.dom(this.$.paperCardEvent).querySelector('.card-content').appendChild(divLocal);
                    },
                    _handleSelectionChanged: function(event) {
                    var divLocal = document.createElement('div');
                    if (event.detail.selected) {
                    var eventRow = document.createTextNode('Row ' + event.detail.selected + ' selected');
                    Polymer.dom(divLocal).appendChild(eventRow);
                    var eventData = document.createTextNode('Data : ' + JSON.stringify(event.detail.data));
                    var brLocal = document.createElement('br');
                    Polymer.dom(divLocal).appendChild(brLocal);
                    Polymer.dom(divLocal).appendChild(eventData);
                    } else {
                    var eventRow = document.createTextNode('Row ' + event.detail.deselected + ' deselected');
                    Polymer.dom(divLocal).appendChild(eventRow);
                    }
                    Polymer.dom(this.$.paperCardEvent).querySelector('.card-content').appendChild(divLocal);
                    },
                    });
            </script>
    </dom-module>
